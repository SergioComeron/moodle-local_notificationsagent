define("local_notificationsagent/notification_assigntemplate",["exports","core/str","core/url"],(function(_exports,_str,_url){var obj;
/**
   *
   * @module   local_notificationsagent/assigntemplate
   * @copyright 2023, ISYC
   * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_url=(obj=_url)&&obj.__esModule?obj:{default:obj};_exports.init=()=>{const RULE_TYPE=["rule","template"],ACTION=["SHOW_CONTEXT","SET_CONTEXT"],RULE_FORCED_TYPE_FORCED=0,RULE_FORCED_TYPE_NONFORCED=1;var idtemplate;$("#assignTemplateModal").on("show.bs.modal",(function(event){var isRuleForced,htmlRuleForced,button=$(event.relatedTarget);idtemplate=button.data("idtemplate");let ruleCard=$('div[id="card-'+idtemplate+'"]');$("#assignTemplateModal #forced-content").empty(),ruleCard.data("type")===RULE_TYPE[0]&&(isRuleForced=ruleCard.data("forced"),(0,_str.get_string)("assignforced","local_notificationsagent").then((forcedRule=>{htmlRuleForced='<div class="custom-control custom-checkbox mr-1">',htmlRuleForced+='<input id="forced" type="checkbox" class="custom-control-input">',htmlRuleForced+='<label class="custom-control-label" for="forced">'+forcedRule+"</label>",htmlRuleForced+="</div>",$("#assignTemplateModal #forced-content").append(htmlRuleForced),isRuleForced||$("#assignTemplateModal #forced-content #forced").prop("checked",!0)})));var modal=$(this);modal.find(".modal-title > span").text($("#card-"+idtemplate+" .badge-type").text()),modal.find(".badge").text($("#card-"+idtemplate+" .badge-type").text()),modal.find(".badge").attr("class","mr-2 "+$("#card-"+idtemplate+" .badge-type").attr("class")),modal.find(".modal-body .name").text($("#card-"+idtemplate+" .name").text()),$.ajax({type:"POST",url:_url.default.relativeUrl("/local/notificationsagent/assignrule.php"),data:{ruleid:idtemplate,action:ACTION[0]},success:function(data){data.category.forEach((categoryid=>{let category=$("#assignTemplateModal .category-listing input#checkboxcategory-"+categoryid);category.length&&(category.prop("checked",!0),$("#category-listing-content-"+categoryid+' input[type="checkbox"]').prop("checked",!0),$("#listitem-category-"+categoryid+' input[type="checkbox"]').prop("checked",!0))})),data.course.forEach((courseid=>{let course=$("#assignTemplateModal .category-listing input#checkboxcourse-"+courseid);course.length&&course.prop("checked",!0)}))},error:function(XMLHttpRequest,textStatus,errorThrown){console.log("Status: "+textStatus),console.log(errorThrown)},dataType:"json"})})),$("#assignTemplateModal").on("hide.bs.modal",(function(){$("#assignTemplateModal .custom-control-input").prop("checked",!1)})),$("#assignTemplateModal .collapse").on("show.bs.collapse",(function(){$(this).parents(".listitem-category").removeClass("collapsed")})),$("#assignTemplateModal .collapse").on("hide.bs.collapse",(function(){$(this).parents(".listitem-category").addClass("collapsed")})),$("#assignTemplateModal #course-category-select-all").on("click",(function(){$("#assignTemplateModal .category-listing .custom-control-input").prop("checked",$(this).prop("checked"))})),$("#assignTemplateModal .category-listing").on("change","input[type=checkbox]",(function(){var checkssubcategoriescourses="#category-listing-content-"+$(this).attr("id").replace("checkboxcategory-","")+" .custom-control-input";$("#assignTemplateModal .category-listing "+checkssubcategoriescourses).prop("checked",$(this).prop("checked"))})),$("#assignTemplateModal #saveassignTemplateModal").on("click",(function(){var data={category:[],course:[]},allCategories=[];forced=RULE_FORCED_TYPE_NONFORCED,$("#assignTemplateModal #forced").prop("checked")&&(forced=RULE_FORCED_TYPE_FORCED),$('#assignTemplateModal #category-listing-content-0 > li[id^="listitem-category-"]').has('input[id^="checkboxcategory-"]:checked').each((function(){let items=$("#"+this.id+' input[id^="checkboxcategory-"]:checked').map((function(){let id=$(this).attr("id").replace("checkboxcategory-",""),parent=$(this).data("parent").replace("#category-listing-content-","");return-1===$.inArray(id,allCategories)&&allCategories.push(id),{id:id,parent:parent}})).get();var parents=$.map(items,(function(item){return item.id}));$.grep(items,(function(item){-1===$.inArray(item.parent,parents)&&data.category.push(item.id)}))}));let courses=$('#assignTemplateModal .category-listing input[id^="checkboxcourse-"]:checked').map((function(){return{id:$(this).attr("id").replace("checkboxcourse-",""),category:$(this).data("parent").replace("#category-listing-content-","")}})).get();$.isEmptyObject(data.category)?$.each(courses,(function(index,course){data.course.push(course.id)})):$.grep(courses,(function(course){-1===$.inArray(course.category,allCategories)&&data.course.push(course.id)})),$.ajax({type:"POST",url:_url.default.relativeUrl("/local/notificationsagent/assignrule.php"),data:{ruleid:idtemplate,category:data.category,course:data.course,forced:forced,action:ACTION[1]},success:function(){window.location.reload()},error:function(XMLHttpRequest,textStatus,errorThrown){console.log("Status: "+textStatus),console.log(errorThrown)},dataType:"json"})}))}}));

//# sourceMappingURL=notification_assigntemplate.min.js.map