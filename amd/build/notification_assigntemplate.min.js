/**
 *
 * @module   local_notificationsagent/assigntemplate
 * @copyright 2023, ISYC
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_notificationsagent/notification_assigntemplate",[],(function(){return{init:function(){var idtemplate;$("#assignTemplateModal").on("show.bs.modal",(function(event){var button=$(event.relatedTarget);idtemplate=button.data("idtemplate");var modal=$(this);modal.find(".modal-title > span").text($("#card-"+idtemplate+" .badge").text()),modal.find(".badge").text($("#card-"+idtemplate+" .badge").text()),modal.find(".badge").attr("class","mr-2 "+$("#card-"+idtemplate+" .badge").attr("class")),modal.find(".modal-body .name").text($("#card-"+idtemplate+" .name").text()),$.ajax({type:"POST",url:"/local/notificationsagent/assignrule.php",data:{ruleid:idtemplate},success:function(data){data.category.forEach((categoryid=>{let category=$("#assignTemplateModal .category-listing input#checkboxcategory-"+categoryid);category.length&&(category.prop("checked",!0),$("#category-listing-content-"+categoryid+' input[type="checkbox"]').prop("checked",!0),$("#listitem-category-"+categoryid+' input[type="checkbox"]').prop("checked",!0))})),data.course.forEach((courseid=>{let course=$("#assignTemplateModal .category-listing input#checkboxcourse-"+courseid);course.length&&course.prop("checked",!0)}))},error:function(XMLHttpRequest,textStatus,errorThrown){console.log("Status: "+textStatus),console.log(errorThrown)},dataType:"json"})})),$("#assignTemplateModal").on("hide.bs.modal",(function(){$("#assignTemplateModal .custom-control-input").prop("checked",!1)})),$("#assignTemplateModal .collapse").on("show.bs.collapse",(function(){$(this).parents(".listitem-category").removeClass("collapsed")})),$("#assignTemplateModal .collapse").on("hide.bs.collapse",(function(){$(this).parents(".listitem-category").addClass("collapsed")})),$("#assignTemplateModal #course-category-select-all").on("click",(function(){$("#assignTemplateModal .category-listing .custom-control-input").prop("checked",$(this).prop("checked"))})),$("#assignTemplateModal .category-listing").on("change","input[type=checkbox]",(function(){var checkssubcategoriescourses="#category-listing-content-"+$(this).attr("id").replace("checkboxcategory-","")+" .custom-control-input";$("#assignTemplateModal .category-listing "+checkssubcategoriescourses).prop("checked",$(this).prop("checked"))})),$("#assignTemplateModal #saveassignTemplateModal").on("click",(function(){var data={category:[],course:[]},allCategories=[];$('#assignTemplateModal #category-listing-content-0 > li[id^="listitem-category-"]').has('input[id^="checkboxcategory-"]:checked').each((function(){let items=$("#"+this.id+' input[id^="checkboxcategory-"]:checked').map((function(){let id=$(this).attr("id").replace("checkboxcategory-",""),parent=$(this).data("parent").replace("#category-listing-content-","");return-1===$.inArray(id,allCategories)&&allCategories.push(id),{id:id,parent:parent}})).get();var parents=$.map(items,(function(item){return item.id}));$.grep(items,(function(item){-1===$.inArray(item.parent,parents)&&data.category.push(item.id)}))}));let courses=$('#assignTemplateModal .category-listing input[id^="checkboxcourse-"]:checked').map((function(){return{id:$(this).attr("id").replace("checkboxcourse-",""),category:$(this).data("parent").replace("#category-listing-content-","")}})).get();$.isEmptyObject(data.category)?$.each(courses,(function(index,course){data.course.push(course.id)})):$.grep(courses,(function(course){-1===$.inArray(course.category,allCategories)&&data.course.push(course.id)})),$.ajax({type:"POST",url:"/local/notificationsagent/assignrule.php",data:{ruleid:idtemplate,category:data.category,course:data.course},success:function(){window.location.reload()},error:function(XMLHttpRequest,textStatus,errorThrown){console.log("Status: "+textStatus),console.log(errorThrown)},dataType:"json"})}))},loopatfirstparent:function(idparent){let arrayParents=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];var module=this;if("#category-listing-content-0"!=idparent){arrayParents.push(idparent.replace("#category-listing-content-",""));var dataparent=$("#assignTemplateModal .category-listing #listitem-category-"+idparent.replace("#category-listing-content-","")+" > .category-listing-header .custom-control-input").attr("data-parent");return module.loopatfirstparent(dataparent,arrayParents)}return arrayParents}}}));

//# sourceMappingURL=notification_assigntemplate.min.js.map