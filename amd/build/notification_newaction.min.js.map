{"version":3,"file":"notification_newaction.min.js","sources":["../src/notification_newaction.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module javascript to place new actions.\n *\n * @module   mod_simplemod/notification_newaction\n * @category  Classes - autoloading\n * @copyright 2023, ISYC\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n define([], function() {\n\n    return {\n\n        init: function() {\n            let newActionButton = document.getElementById('id_newaction_button');\n            newActionButton.addEventListener('click', function() {\n                let newActionSelect = document.getElementById('id_newaction_select');\n                let $title = newActionSelect.options[newActionSelect.selectedIndex].text;\n                let $formDefault = [];\n                let formNotif = document.querySelector('form[action*=\"notificationsagent\"].mform');\n                Array.from(formNotif.elements).forEach((element) => {\n                    if(element.id){\n                        $formDefault.push(\"[id]\"+element.id+\"[/id][value]\"+element.value+\"[/value]\");\n                    }\n                });\n                let $elements = JSON.parse(newActionSelect.value.split(':')[1]);\n                let $name = newActionSelect.options[newActionSelect.selectedIndex].value.substring(0, newActionSelect.options[newActionSelect.selectedIndex].value.indexOf(':['));\n                let data = {\n                    key: 'action',\n                    action: 'new',\n                    title: $title,\n                    elements: $elements,\n                    name : $name,\n                    formDefault: $formDefault\n                };\n                $.ajax({\n                    type: \"POST\",\n                    url: window.location.pathname.substring(0, '/local/notificationsagent/editrule.php'),\n                    data: data,\n                    success: function(event) {\n                        if(event.state === 'success'){\n                            window.location.reload();  \n                        }\n                    },\n                    error: function(XMLHttpRequest, textStatus, errorThrown) { \n                        console.log(\"Status: \" + textStatus); \n                        console.log(errorThrown); \n                    },\n                    dataType: 'json'\n                });\n            });\n        }\n    }\n});\n"],"names":["define","init","document","getElementById","addEventListener","newActionSelect","$title","options","selectedIndex","text","$formDefault","formNotif","querySelector","Array","from","elements","forEach","element","id","push","value","data","key","action","title","JSON","parse","split","name","substring","indexOf","formDefault","$","ajax","type","url","window","location","pathname","success","event","state","reload","error","XMLHttpRequest","textStatus","errorThrown","console","log","dataType"],"mappings":";;;;;;;;AAwBCA,yDAAO,IAAI,iBAED,CAEHC,KAAM,WACoBC,SAASC,eAAe,uBAC9BC,iBAAiB,SAAS,eAClCC,gBAAkBH,SAASC,eAAe,uBAC1CG,OAASD,gBAAgBE,QAAQF,gBAAgBG,eAAeC,KAChEC,aAAe,GACfC,UAAYT,SAASU,cAAc,4CACvCC,MAAMC,KAAKH,UAAUI,UAAUC,SAASC,UACjCA,QAAQC,IACPR,aAAaS,KAAK,OAAOF,QAAQC,GAAG,eAAeD,QAAQG,MAAM,mBAKrEC,KAAO,CACPC,IAAK,SACLC,OAAQ,MACRC,MAAOlB,OACPS,SANYU,KAAKC,MAAMrB,gBAAgBe,MAAMO,MAAM,KAAK,IAOxDC,KANQvB,gBAAgBE,QAAQF,gBAAgBG,eAAeY,MAAMS,UAAU,EAAGxB,gBAAgBE,QAAQF,gBAAgBG,eAAeY,MAAMU,QAAQ,OAOvJC,YAAarB,cAEjBsB,EAAEC,KAAK,CACHC,KAAM,OACNC,IAAKC,OAAOC,SAASC,SAAST,UAAU,EAAG,0CAC3CR,KAAMA,KACNkB,QAAS,SAASC,OACK,YAAhBA,MAAMC,OACLL,OAAOC,SAASK,UAGxBC,MAAO,SAASC,eAAgBC,WAAYC,aACxCC,QAAQC,IAAI,WAAaH,YACzBE,QAAQC,IAAIF,cAEhBG,SAAU,aAK7B"}