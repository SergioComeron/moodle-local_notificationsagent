{"version":3,"file":"notification_newexception.min.js","sources":["../src/notification_newexception.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module javascript to place new exceptions.\n *\n * @module   mod_simplemod/notification_newexception\n * @category  Classes - autoloading\n * @copyright 2023, ISYC\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n define([], function() {\n\n    return {\n\n        init: function() {\n            let newExceptionButton = document.querySelector('[id*=\"newconditionexception_button\"]');\n            newExceptionButton.addEventListener('click', function() {\n                let newExceptionSelect = document.querySelector('[id*=\"newconditionexception_select\"]');\n                let $title = newExceptionSelect.options[newExceptionSelect.selectedIndex].text;\n                let $formDefault = [];\n                let formNotif = document.querySelector('form[action*=\"notificationsagent\"].mform');\n                Array.from(formNotif.elements).forEach((element) => {\n                    if(element.id){\n                        $formDefault.push(\"[id]\"+element.id+\"[/id][value]\"+element.value+\"[/value]\");\n                    }\n                });\n                let $elements = JSON.parse(newExceptionSelect.value.split(':')[1]);\n                let $name = newExceptionSelect.options[newExceptionSelect.selectedIndex].value.substring(0,\n                  newExceptionSelect.options[newExceptionSelect.selectedIndex].value.indexOf(':['));\n                let data = {\n                    key: 'exception',\n                    action: 'new',\n                    title: $title,\n                    elements: $elements,\n                    name : $name,\n                    formDefault: $formDefault\n                };\n\n                $.ajax({\n                    type: \"POST\",\n                    url: window.location.pathname.substring(0, '/local/notificationsagent/editrule.php'),\n                    data: data,\n                    success: function(event) {\n                        if(event.state === 'success'){\n                            window.location.reload();\n                        }\n                    },\n                    error: function(XMLHttpRequest, textStatus, errorThrown) {\n                        console.log(\"Status: \" + textStatus);\n                        console.log(errorThrown);\n                    },\n                    dataType: 'json'\n                });\n            });\n        }\n    }\n});\n"],"names":["define","init","document","querySelector","addEventListener","newExceptionSelect","$title","options","selectedIndex","text","$formDefault","formNotif","Array","from","elements","forEach","element","id","push","value","data","key","action","title","JSON","parse","split","name","substring","indexOf","formDefault","$","ajax","type","url","window","location","pathname","success","event","state","reload","error","XMLHttpRequest","textStatus","errorThrown","console","log","dataType"],"mappings":";;;;;;;;AAwBCA,4DAAO,IAAI,iBAED,CAEHC,KAAM,WACuBC,SAASC,cAAc,wCAC7BC,iBAAiB,SAAS,eACrCC,mBAAqBH,SAASC,cAAc,wCAC5CG,OAASD,mBAAmBE,QAAQF,mBAAmBG,eAAeC,KACtEC,aAAe,GACfC,UAAYT,SAASC,cAAc,4CACvCS,MAAMC,KAAKF,UAAUG,UAAUC,SAASC,UACjCA,QAAQC,IACPP,aAAaQ,KAAK,OAAOF,QAAQC,GAAG,eAAeD,QAAQG,MAAM,mBAMrEC,KAAO,CACPC,IAAK,YACLC,OAAQ,MACRC,MAAOjB,OACPQ,SAPYU,KAAKC,MAAMpB,mBAAmBc,MAAMO,MAAM,KAAK,IAQ3DC,KAPQtB,mBAAmBE,QAAQF,mBAAmBG,eAAeW,MAAMS,UAAU,EACvFvB,mBAAmBE,QAAQF,mBAAmBG,eAAeW,MAAMU,QAAQ,OAOzEC,YAAapB,cAGjBqB,EAAEC,KAAK,CACHC,KAAM,OACNC,IAAKC,OAAOC,SAASC,SAAST,UAAU,EAAG,0CAC3CR,KAAMA,KACNkB,QAAS,SAASC,OACK,YAAhBA,MAAMC,OACLL,OAAOC,SAASK,UAGxBC,MAAO,SAASC,eAAgBC,WAAYC,aACxCC,QAAQC,IAAI,WAAaH,YACzBE,QAAQC,IAAIF,cAEhBG,SAAU,aAK7B"}