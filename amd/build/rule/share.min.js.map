{"version":3,"file":"share.min.js","sources":["../../src/rule/share.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n// Project implemented by the \\\"Recovery, Transformation and Resilience Plan.\n// Funded by the European Union - Next GenerationEU\\\".\n//\n// Produced by the UNIMOODLE University Group: Universities of\n// Valladolid, Complutense de Madrid, UPV/EHU, León, Salamanca,\n// Illes Balears, Valencia, Rey Juan Carlos, La Laguna, Zaragoza, Málaga,\n// Córdoba, Extremadura, Vigo, Las Palmas de Gran Canaria y Burgos.\n\n/**\n * Version details\n *\n * @package    local_notificationsagent\n * @copyright  2023 Proyecto UNIMOODLE\n * @author     UNIMOODLE Group (Coordinator) <direccion.area.estrategia.digital@uva.es>\n * @author     ISYC <soporte@isyc.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {get_strings as getStrings} from 'core/str';\nimport Notification from 'core/notification';\nimport {updateRuleShare} from 'local_notificationsagent/rule/repository';\n\n/**\n * Types of rule sharing\n * \n * @type {{RULE_SHARE: boolean}}\n */\nconst RULE_SHARE = {\n    SHARED: 0,\n    UNSHARED: 1,\n};\n\n/**\n * Text to be displayed when sharing, or stop sharing a rule.\n * \n * @type {{RULE_SHARE_STRING: string}}\n */\nconst RULE_SHARE_STRING = [\n    {\n        key: 'shareaccept', component: 'local_notificationsagent',\n    },\n    {\n        key: 'unshareaccept', component: 'local_notificationsagent',\n    }\n];\n\nexport const init = () => {\n    $('#shareRuleModal').on('show.bs.modal', function (e) {\n        shareRuleBtn = $(e.relatedTarget);\n        let id = shareRuleBtn.data('ruleid');\n        let shareValue = shareRuleBtn.data('value');\n\n        if (!shareValue) {\n            shareValue = RULE_SHARE.SHARED;\n        } else {\n            shareValue = RULE_SHARE.UNSHARED;\n        }\n\n        const modal = $(this);\n\n        const requiredStrings = [\n            [\n                {key: 'sharetitle', component: 'local_notificationsagent', param: {\n                    title: $('#card-' + id + ' .name').text()\n                }},\n                {key: 'sharecontent', component: 'local_notificationsagent', param: {\n                    title: $('#card-' + id + ' .name').text()\n                }},\n            ],\n            [\n                {key: 'unsharetitle', component: 'local_notificationsagent', param: {\n                    title: $('#card-' + id + ' .name').text()\n                }},\n                {key: 'unsharecontent', component: 'local_notificationsagent', param: {\n                    title: $('#card-' + id + ' .name').text()\n                }},\n            ]\n        ]\n\n        getStrings(requiredStrings[shareValue]).then(([ruleTitle, ruleContent]) => {\n            modal.find('.modal-title').text(ruleTitle);\n            modal.find('.modal-body > div').text(ruleContent);\n        });\n    });\n\n    $('#shareRuleModal #acceptShareRule').on('click', (e) => {\n        e.preventDefault();\n        setRuleShare(shareRuleBtn);\n    });\n};\n\n/**\n * Changes the sharing status for a given rule\n * \n * @param {HTMLElement} ruleButton\n * @returns {Promise<void>}\n */\nconst setRuleShare = async(shareRuleBtn) => {\n    let id = shareRuleBtn.data('ruleid');\n    let status = shareRuleBtn.data('value');\n\n    if (!status) {\n        status = RULE_SHARE.SHARED;\n    } else {\n        status = RULE_SHARE.UNSHARED;\n    }\n\n    $('#shareRuleModal').modal('hide');\n\n    try {\n        response = await updateRuleShare(id, status);\n        \n        if ($.isEmptyObject(response['warnings'])) {\n            shareRuleBtn.addClass('d-none');\n\n            getStrings(RULE_SHARE_STRING).then(([ruleShared, ruleUnshared]) => {\n                if (status) {\n                    $('a[data-ruleid=\"' + id + '\"][data-target=\"#shareRuleModal\"][data-value=\"0\"]').removeClass('d-none');\n                    Notification.addNotification({\n                        message: ruleUnshared,\n                        type: \"info\"\n                    });\n                } else {\n                    $('a[data-ruleid=\"' + id + '\"][data-target=\"#shareRuleModal\"][data-value=\"1\"]').removeClass('d-none');\n                    Notification.addNotification({\n                        message: ruleShared,\n                        type: \"info\"\n                    });\n                }\n            });\n        } else {\n            Notification.addNotification({\n                message: response['warnings'][0].message,\n                type: 'error'\n            });\n        }\n    } catch (exception) {\n        Notification.exception(exception);\n    }\n};"],"names":["RULE_SHARE","RULE_SHARE_STRING","key","component","$","on","e","shareRuleBtn","relatedTarget","id","data","shareValue","modal","this","requiredStrings","param","title","text","then","_ref","ruleTitle","ruleContent","find","preventDefault","setRuleShare","async","status","response","isEmptyObject","addClass","_ref2","ruleShared","ruleUnshared","removeClass","addNotification","message","type","exception"],"mappings":";;;;;;;;;4JAyCMA,kBACM,EADNA,oBAEQ,EAQRC,kBAAoB,CACtB,CACIC,IAAK,cAAeC,UAAW,4BAEnC,CACID,IAAK,gBAAiBC,UAAW,2CAIrB,KAChBC,EAAE,mBAAmBC,GAAG,iBAAiB,SAAUC,GAC/CC,aAAeH,EAAEE,EAAEE,mBACfC,GAAKF,aAAaG,KAAK,UACvBC,WAAaJ,aAAaG,KAAK,SAK/BC,WAHCA,WAGYX,oBAFAA,wBAKXY,MAAQR,EAAES,MAEVC,gBAAkB,CACpB,CACI,CAACZ,IAAK,aAAcC,UAAW,2BAA4BY,MAAO,CAC9DC,MAAOZ,EAAE,SAAWK,GAAK,UAAUQ,SAEvC,CAACf,IAAK,eAAgBC,UAAW,2BAA4BY,MAAO,CAChEC,MAAOZ,EAAE,SAAWK,GAAK,UAAUQ,UAG3C,CACI,CAACf,IAAK,eAAgBC,UAAW,2BAA4BY,MAAO,CAChEC,MAAOZ,EAAE,SAAWK,GAAK,UAAUQ,SAEvC,CAACf,IAAK,iBAAkBC,UAAW,2BAA4BY,MAAO,CAClEC,MAAOZ,EAAE,SAAWK,GAAK,UAAUQ,gCAKpCH,gBAAgBH,aAAaO,MAAKC,WAAEC,UAAWC,kBACtDT,MAAMU,KAAK,gBAAgBL,KAAKG,WAChCR,MAAMU,KAAK,qBAAqBL,KAAKI,mBAI7CjB,EAAE,oCAAoCC,GAAG,SAAUC,IAC/CA,EAAEiB,iBACFC,aAAajB,wBAUfiB,aAAeC,MAAAA,mBACbhB,GAAKF,aAAaG,KAAK,UACvBgB,OAASnB,aAAaG,KAAK,SAK3BgB,OAHCA,OAGQ1B,oBAFAA,kBAKbI,EAAE,mBAAmBQ,MAAM,YAGvBe,eAAiB,+BAAgBlB,GAAIiB,QAEjCtB,EAAEwB,cAAcD,SAAQ,WACxBpB,aAAasB,SAAS,+BAEX5B,mBAAmBiB,MAAKY,YAAEC,WAAYC,oBACzCN,QACAtB,EAAE,kBAAoBK,GAAK,qDAAqDwB,YAAY,gCAC/EC,gBAAgB,CACzBC,QAASH,aACTI,KAAM,WAGVhC,EAAE,kBAAoBK,GAAK,qDAAqDwB,YAAY,gCAC/EC,gBAAgB,CACzBC,QAASJ,WACTK,KAAM,oCAKLF,gBAAgB,CACzBC,QAASR,SAAQ,SAAa,GAAGQ,QACjCC,KAAM,UAGhB,MAAOC,iCACQA,UAAUA"}