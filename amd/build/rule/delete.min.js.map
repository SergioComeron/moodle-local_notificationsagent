{"version":3,"file":"delete.min.js","sources":["../../src/rule/delete.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module    local_notificationsagent/rule/delete\n * @copyright 2023 ISYC <soporte@isyc.com>\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {get_string as getString, get_strings as getStrings} from 'core/str';\nimport Notification from 'core/notification';\nimport {checkRuleContext, deleteRule} from 'local_notificationsagent/rule/repository';\n\n/**\n * Registers the click event listener for the delete button of a rule\n */\nexport const init = () => {\n    $('#deleteRuleModal').on('show.bs.modal', function (e) {\n        ruleButton = $(e.relatedTarget);\n        let id = ruleButton.data('ruleid');\n        let ruleType = ruleButton.data('type');\n\n        const modal = $(this);\n\n        hasRuleContext(ruleButton).then(hasContext => {\n            if (hasContext) {\n                requiredStrings = [\n                    {key: 'deletetitle', component: 'local_notificationsagent', param: {\n                        title: $('#card-' + id + ' .name').text(),\n                        type: ruleType,\n                    }},\n                    {key: 'deletecontent_hascontext', component: 'local_notificationsagent', param: {\n                        title: $('#card-' + id + ' .name').text(),\n                        type: ruleType,\n                    }},\n                ];\n            } else {\n                requiredStrings = [\n                    {key: 'deletetitle', component: 'local_notificationsagent', param: {\n                        title: $('#card-' + id + ' .name').text(),\n                        type: ruleType,\n                    }},\n                    {key: 'deletecontent_nocontext', component: 'local_notificationsagent', param: {\n                        title: $('#card-' + id + ' .name').text(),\n                        type: ruleType,\n                    }},\n                ];\n            }\n    \n            getStrings(requiredStrings).then(([ruleTitle, ruleContent]) => {\n                modal.find('.modal-title').text(ruleTitle);\n                modal.find('.modal-body > div').text(ruleContent);\n            });\n        });\n    });\n\n    $('#deleteRuleModal #acceptDeleteRule').on('click', (e) => {\n        e.preventDefault();\n\n        setDeleteRule(ruleButton);\n    });\n};\n\n/**\n * Check if the rule has any other context before deleting\n * \n * @param {HTMLElement} ruleButton\n * @returns {boolean} Has it context?\n */\nconst hasRuleContext = async(ruleButton) => {\n    let id = ruleButton.data('ruleid');\n    let hasContext = false;\n\n    try {\n        response = await checkRuleContext(id);\n        \n        if ($.isEmptyObject(response['warnings'])) {\n            hasContext = response['hascontext'];\n        } else {\n            Notification.addNotification({\n                message: response['warnings'][0].message,\n                type: 'error'\n            });\n        }\n    } catch (exception) {\n        Notification.exception(exception);\n    }\n\n    return hasContext;\n};\n\n\n/**\n * Deletes a given rule\n * \n * @param {HTMLElement} ruleButton\n * @returns {Promise<void>}\n */\nconst setDeleteRule = async(ruleButton) => {\n    let id = ruleButton.data('ruleid');\n\n    $('#deleteRuleModal').modal('hide');\n\n    try {\n        response = await deleteRule(id);\n        \n        if ($.isEmptyObject(response['warnings'])) {\n            ruleButton.addClass('d-none');\n    \n            getString('deleteaccept', 'local_notificationsagent').then(ruleDeleted => {\n                ruleButton.addClass('d-none');\n        \n                $('div[id=\"card-' + id + '\"]').remove();\n               \n                Notification.addNotification({\n                    message: ruleDeleted,\n                    type: 'info'\n                }); \n            });\n        } else {\n            Notification.addNotification({\n                message: response['warnings'][0].message,\n                type: 'error'\n            });\n        }\n    } catch (exception) {\n        Notification.exception(exception);\n    }\n};"],"names":["$","on","e","ruleButton","relatedTarget","id","data","ruleType","modal","this","hasRuleContext","then","hasContext","requiredStrings","key","component","param","title","text","type","_ref","ruleTitle","ruleContent","find","preventDefault","setDeleteRule","async","response","isEmptyObject","addNotification","message","exception","addClass","ruleDeleted","remove"],"mappings":";;;;;oKA4BoB,KAChBA,EAAE,oBAAoBC,GAAG,iBAAiB,SAAUC,GAChDC,WAAaH,EAAEE,EAAEE,mBACbC,GAAKF,WAAWG,KAAK,UACrBC,SAAWJ,WAAWG,KAAK,cAEzBE,MAAQR,EAAES,MAEhBC,eAAeP,YAAYQ,MAAKC,aAExBC,gBADAD,WACkB,CACd,CAACE,IAAK,cAAeC,UAAW,2BAA4BC,MAAO,CAC/DC,MAAOjB,EAAE,SAAWK,GAAK,UAAUa,OACnCC,KAAMZ,WAEV,CAACO,IAAK,2BAA4BC,UAAW,2BAA4BC,MAAO,CAC5EC,MAAOjB,EAAE,SAAWK,GAAK,UAAUa,OACnCC,KAAMZ,YAII,CACd,CAACO,IAAK,cAAeC,UAAW,2BAA4BC,MAAO,CAC/DC,MAAOjB,EAAE,SAAWK,GAAK,UAAUa,OACnCC,KAAMZ,WAEV,CAACO,IAAK,0BAA2BC,UAAW,2BAA4BC,MAAO,CAC3EC,MAAOjB,EAAE,SAAWK,GAAK,UAAUa,OACnCC,KAAMZ,iCAKPM,iBAAiBF,MAAKS,WAAEC,UAAWC,kBAC1Cd,MAAMe,KAAK,gBAAgBL,KAAKG,WAChCb,MAAMe,KAAK,qBAAqBL,KAAKI,sBAKjDtB,EAAE,sCAAsCC,GAAG,SAAUC,IACjDA,EAAEsB,iBAEFC,cAActB,sBAUhBO,eAAiBgB,MAAAA,iBACfrB,GAAKF,WAAWG,KAAK,UACrBM,YAAa,MAGbe,eAAiB,gCAAiBtB,IAE9BL,EAAE4B,cAAcD,SAAQ,UACxBf,WAAae,SAAQ,iCAERE,gBAAgB,CACzBC,QAASH,SAAQ,SAAa,GAAGG,QACjCX,KAAM,UAGhB,MAAOY,iCACQA,UAAUA,kBAGpBnB,YAULa,cAAgBC,MAAAA,iBACdrB,GAAKF,WAAWG,KAAK,UAEzBN,EAAE,oBAAoBQ,MAAM,YAGxBmB,eAAiB,0BAAWtB,IAExBL,EAAE4B,cAAcD,SAAQ,WACxBxB,WAAW6B,SAAS,8BAEV,eAAgB,4BAA4BrB,MAAKsB,cACvD9B,WAAW6B,SAAS,UAEpBhC,EAAE,gBAAkBK,GAAK,MAAM6B,+BAElBL,gBAAgB,CACzBC,QAASG,YACTd,KAAM,mCAIDU,gBAAgB,CACzBC,QAASH,SAAQ,SAAa,GAAGG,QACjCX,KAAM,UAGhB,MAAOY,iCACQA,UAAUA"}