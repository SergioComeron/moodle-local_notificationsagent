{"version":3,"file":"notification_placeholders.min.js","sources":["../src/notification_placeholders.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module javascript to place the placeholders.\n * Modified version of IOMAD Email template emailvars.\n *\n * @module   mod_simplemod/notification_placeholders\n * @category  Classes - autoloading\n * @copyright 2023, ISYC\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([], function() {\n\n    return {\n\n        /**\n         * Setup the classes to editors works with placeholders.\n         */\n        init: function() {\n            var module = this;\n            var clickforword = document.getElementsByClassName('clickforword');\n            for (var i = 0; i < clickforword.length; i++) {\n                clickforword[i].addEventListener('click', function(e) {\n                    e.preventDefault(); // To prevent the default behaviour of a tag.\n                    var idAction = e.target.closest(\"div.notificationvars\").getAttribute(\"id\").replace(\"notificationvars_\",\"\").split('_')[0];\n                    var typeitem = e.target.closest(\"div.notificationvars\").getAttribute(\"id\").replace(\"notificationvars_\",\"\").split('_')[1];\n                    module.insertAtCaret(e.target.closest(\".fitem\").previousElementSibling.getAttribute(\"id\"), \"{\" + this.getAttribute('data-text') + \"}\", idAction, typeitem);\n                });\n            }\n        },\n\n        /**\n         * Insert the placeholder in selected caret place.\n         * @param  {string} myValue\n         * @param  {int} idAction\n         */\n        insertAtCaret: function(idContainerReplace, myValue, idAction, typeitem) {\n            var sel, range;\n\n            if(typeitem == 'message'){\n                if(window.getSelection().type !== 'None' && \n                    ($(window.getSelection().baseNode).closest(\"[id^='id_'][id*='_\"+idAction+\"'][id$='editable']\").attr(\"id\") !== undefined || \n                    $(window.getSelection().focusNode).closest(\"[id^='id_'][id*='_\"+idAction+\"'][id$='editable']\").attr(\"id\") !== undefined)){\n                    sel = window.getSelection();\n                    if (sel.getRangeAt && sel.rangeCount) {\n                        range = sel.getRangeAt(0);\n                        range.deleteContents();\n                        range.insertNode(document.createTextNode(myValue));\n\n                        for (let position = 0; position != (myValue.length + 1); position++) {\n                            sel.modify(\"move\", \"right\", \"character\");\n                        }\n                    }\n                }else{\n                    var thiselem = document.querySelectorAll(\"#\"+idContainerReplace+\" [id^='id_'][id*='_\"+idAction+\"'][id$='editable']\");\n                    thiselem[0].appendChild(document.createTextNode(myValue));\n                }\n            }else if(typeitem == 'text'){\n                var thiselem = document.querySelectorAll(\"#\"+idContainerReplace+\" [type='\"+typeitem+\"'][id^='id_'][id*='_\"+idAction+\"']\");\n                thiselem[0].value = thiselem[0].value + myValue;\n            }\n        },\n    };\n});\n"],"names":["define","init","module","this","clickforword","document","getElementsByClassName","i","length","addEventListener","e","preventDefault","idAction","target","closest","getAttribute","replace","split","typeitem","insertAtCaret","previousElementSibling","idContainerReplace","myValue","sel","range","window","getSelection","type","undefined","$","baseNode","attr","focusNode","thiselem","querySelectorAll","appendChild","createTextNode","getRangeAt","rangeCount","deleteContents","insertNode","position","modify","value"],"mappings":";;;;;;;;;AAyBAA,4DAAO,IAAI,iBAEA,CAKHC,KAAM,mBACEC,OAASC,KACTC,aAAeC,SAASC,uBAAuB,gBAC1CC,EAAI,EAAGA,EAAIH,aAAaI,OAAQD,IACrCH,aAAaG,GAAGE,iBAAiB,SAAS,SAASC,GAC/CA,EAAEC,qBACEC,SAAWF,EAAEG,OAAOC,QAAQ,wBAAwBC,aAAa,MAAMC,QAAQ,oBAAoB,IAAIC,MAAM,KAAK,GAClHC,SAAWR,EAAEG,OAAOC,QAAQ,wBAAwBC,aAAa,MAAMC,QAAQ,oBAAoB,IAAIC,MAAM,KAAK,GACtHf,OAAOiB,cAAcT,EAAEG,OAAOC,QAAQ,UAAUM,uBAAuBL,aAAa,MAAO,IAAMZ,KAAKY,aAAa,aAAe,IAAKH,SAAUM,cAU7JC,cAAe,SAASE,mBAAoBC,QAASV,SAAUM,cACvDK,IAAKC,SAEM,WAAZN,aACmC,SAA/BO,OAAOC,eAAeC,WACyFC,IAA7GC,EAAEJ,OAAOC,eAAeI,UAAUhB,QAAQ,qBAAqBF,SAAS,sBAAsBmB,KAAK,YACUH,IAA9GC,EAAEJ,OAAOC,eAAeM,WAAWlB,QAAQ,qBAAqBF,SAAS,sBAAsBmB,KAAK,OAYhGE,SAAW5B,SAAS6B,iBAAiB,IAAIb,mBAAmB,sBAAsBT,SAAS,uBACtF,GAAGuB,YAAY9B,SAAS+B,eAAed,mBAZhDC,IAAME,OAAOC,gBACLW,YAAcd,IAAIe,WAAY,EAClCd,MAAQD,IAAIc,WAAW,IACjBE,iBACNf,MAAMgB,WAAWnC,SAAS+B,eAAed,cAEpC,IAAImB,SAAW,EAAGA,UAAanB,QAAQd,OAAS,EAAIiC,WACrDlB,IAAImB,OAAO,OAAQ,QAAS,mBAOtC,GAAe,QAAZxB,SAAmB,KACpBe,UAAAA,SAAW5B,SAAS6B,iBAAiB,IAAIb,mBAAmB,WAAWH,SAAS,uBAAuBN,SAAS,OAC3G,GAAG+B,MAAQV,SAAS,GAAGU,MAAQrB"}