{"version":3,"file":"notification_editruleformactions.min.js","sources":["../src/notification_editruleformactions.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * Module javascript to place conditionremove.\n *\n * @module    notification_conditionremove\n * @category  Classes - autoloading\n * @copyright 2023, ISYC\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([], function () {\n\n    /**\n     * FormConditionRemove object.\n     */\n    var FormConditionRemove = function () {\n        this.init();\n        this.registerEvents();\n    };\n\n    /** @var {Boolean} The FormConditionRemove button selector. */\n    FormConditionRemove.prototype.buttonSelector = false;\n\n    FormConditionRemove.prototype.registerEvents = function () {\n        var self = this;\n        window.addEventListener(\"beforeunload\", (event) => {\n            if (self.buttonSelector) {\n                event.stopImmediatePropagation();\n            }\n            self.buttonSelector = false;\n        }, true);\n    }\n\n    FormConditionRemove.prototype.init = function () {\n        var self = this;\n\n        let buttonActions = document.querySelectorAll(\"h5>i.icon[id*='_']:not(.disabled)\");\n        buttonActions.forEach(function (button) {\n            button.addEventListener('click', function (event) {\n                self.buttonSelector = true\n                let $typesection = event.target.id.split('_')[0].replace(/[0-9]/g, '');\n                let $actionelement = event.target.id.split('_')[1];\n                let $keyelementsession = parseInt(event.target.id.replace($typesection, '').replace('_remove', ''));\n                let $formDefault = [];\n\n                if (window.location.href.includes('action=edit')) {\n                    let url = new URL(window.location.href);\n                    var ruleid = url.searchParams.get('ruleid');\n                    if (ruleid) {\n                        $formDefault.push(\"[id]ruleid[/id][value]\" + ruleid + \"[/value]\");\n                    }\n                }\n\n                let formNotif = document.querySelector('form[action*=\"notificationsagent\"].mform');\n                let idSectionRemove = \"\";\n                Array.from(formNotif.elements).forEach((element) => {\n                    if (element.id) {\n                        var elementID = element.id;\n                        var keySection = elementID.split('_' + $typesection).pop().split('_')[0];\n                        if (element.id.includes(\"_\" + $typesection)) {\n                            //¿Eres la sección eliminada?\n                            if (idSectionRemove && idSectionRemove < keySection) {\n                                //Si lo eres, reduce en 1 el id de la sección (condition, action...)\n                                var elementID = element.id.split($typesection + keySection).join($typesection + (keySection - 1));\n                            }\n                        }\n\n                        //Si no perteneces a la sección eliminada, te guardo el valor\n                        if (!element.id.includes($typesection + ($keyelementsession + 1))) {\n                            $formDefault.push(\"[id]\" + elementID + \"[/id][value]\" + element.value + \"[/value]\");\n                        } else {\n                            //Si perteneces a la sección eliminada, idSectionRemove de la sección y las secciones posteriores reducir a 1 el id de las secciones posteriores\n                            idSectionRemove = $keyelementsession + 1;\n                        }\n                    }\n                });\n\n                let $availabilityconditionsjson = document.getElementById('id_availabilityconditionsjson').value\n                let data = {\n                    key: $typesection,\n                    action: $actionelement,\n                    keyelementsession: $keyelementsession,\n                    formDefault: $formDefault,\n                    availabilityconditionsjson: $availabilityconditionsjson\n                };\n                if (data.key === 'conditionexception') {\n                    data.key = data.key.replace(/condition/, '');\n                }\n\n                $.ajax({\n                    type: \"POST\",\n                    url: window.location.pathname.substring(0, '/local/notificationsagent/editrule.php'),\n                    data: data,\n                    success: function (event) {\n                        if (event.state === 'success') {\n                            window.location.reload();\n                        }\n                    },\n                    error: function (XMLHttpRequest, textStatus, errorThrown) {\n                        console.log(\"Status: \" + textStatus);\n                        console.log(errorThrown);\n                    },\n                    dataType: 'json'\n                });\n\n            });\n        });\n    };\n\n    return {\n\n        /**\n         * Main initialisation.\n         * @method init\n         */\n        init: function () {\n            // Create instance.\n            new FormConditionRemove();\n        }\n\n    }\n});"],"names":["define","FormConditionRemove","init","registerEvents","prototype","buttonSelector","self","this","window","addEventListener","event","stopImmediatePropagation","document","querySelectorAll","forEach","button","$typesection","target","id","split","replace","$actionelement","$keyelementsession","parseInt","$formDefault","location","href","includes","ruleid","URL","searchParams","get","push","formNotif","querySelector","idSectionRemove","Array","from","elements","element","keySection","elementID","pop","join","value","$availabilityconditionsjson","getElementById","data","key","action","keyelementsession","formDefault","availabilityconditionsjson","$","ajax","type","url","pathname","substring","success","state","reload","error","XMLHttpRequest","textStatus","errorThrown","console","log","dataType"],"mappings":";;;;;;;;AAwBAA,mEAAO,IAAI,eAKHC,oBAAsB,gBACjBC,YACAC,yBAITF,oBAAoBG,UAAUC,gBAAiB,EAE/CJ,oBAAoBG,UAAUD,eAAiB,eACvCG,KAAOC,KACXC,OAAOC,iBAAiB,gBAAiBC,QACjCJ,KAAKD,gBACLK,MAAMC,2BAEVL,KAAKD,gBAAiB,KACvB,IAGPJ,oBAAoBG,UAAUF,KAAO,eAC7BI,KAAOC,KAESK,SAASC,iBAAiB,qCAChCC,SAAQ,SAAUC,QAC5BA,OAAON,iBAAiB,SAAS,SAAUC,OACvCJ,KAAKD,gBAAiB,MAClBW,aAAeN,MAAMO,OAAOC,GAAGC,MAAM,KAAK,GAAGC,QAAQ,SAAU,IAC/DC,eAAiBX,MAAMO,OAAOC,GAAGC,MAAM,KAAK,GAC5CG,mBAAqBC,SAASb,MAAMO,OAAOC,GAAGE,QAAQJ,aAAc,IAAII,QAAQ,UAAW,KAC3FI,aAAe,MAEfhB,OAAOiB,SAASC,KAAKC,SAAS,eAAgB,KAE1CC,OADM,IAAIC,IAAIrB,OAAOiB,SAASC,MACjBI,aAAaC,IAAI,UAC9BH,QACAJ,aAAaQ,KAAK,yBAA2BJ,OAAS,gBAI1DK,UAAYrB,SAASsB,cAAc,4CACnCC,gBAAkB,GACtBC,MAAMC,KAAKJ,UAAUK,UAAUxB,SAASyB,aAChCA,QAAQrB,GAAI,KAERsB,YADAC,UAAYF,QAAQrB,IACGC,MAAM,IAAMH,cAAc0B,MAAMvB,MAAM,KAAK,MAClEoB,QAAQrB,GAAGS,SAAS,IAAMX,eAEtBmB,iBAAmBA,gBAAkBK,eAEjCC,UAAYF,QAAQrB,GAAGC,MAAMH,aAAewB,YAAYG,KAAK3B,cAAgBwB,WAAa,IAKjGD,QAAQrB,GAAGS,SAASX,cAAgBM,mBAAqB,IAI1Da,gBAAkBb,mBAAqB,EAHvCE,aAAaQ,KAAK,OAASS,UAAY,eAAiBF,QAAQK,MAAQ,oBAQhFC,4BAA8BjC,SAASkC,eAAe,iCAAiCF,MACvFG,KAAO,CACPC,IAAKhC,aACLiC,OAAQ5B,eACR6B,kBAAmB5B,mBACnB6B,YAAa3B,aACb4B,2BAA4BP,6BAEf,uBAAbE,KAAKC,MACLD,KAAKC,IAAMD,KAAKC,IAAI5B,QAAQ,YAAa,KAG7CiC,EAAEC,KAAK,CACHC,KAAM,OACNC,IAAKhD,OAAOiB,SAASgC,SAASC,UAAU,EAAG,0CAC3CX,KAAMA,KACNY,QAAS,SAAUjD,OACK,YAAhBA,MAAMkD,OACNpD,OAAOiB,SAASoC,UAGxBC,MAAO,SAAUC,eAAgBC,WAAYC,aACzCC,QAAQC,IAAI,WAAaH,YACzBE,QAAQC,IAAIF,cAEhBG,SAAU,gBAOnB,CAMHlE,KAAM,eAEED"}
