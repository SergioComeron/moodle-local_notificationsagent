{"version":3,"file":"notification_editruleformactions.min.js","sources":["../src/notification_editruleformactions.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module javascript to place conditionactions.\n *\n * @module   mod_simplemod/notification_conditionactions\n * @category  Classes - autoloading\n * @copyright 2023, ISYC\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n define([], function() {\n\n    return {\n\n        init: function() {\n\n            let buttonActions = document.querySelectorAll(\"h5>i.icon[id*='_']:not(.disabled)\");\n            buttonActions.forEach( function(button) {\n                button.addEventListener('click', function(event) {\n                    let $typesection = event.target.id.split('_')[0].replace(/[0-9]/g, '');\n                    let $actionelement = event.target.id.split('_')[1];\n                    let $keyelementsession = parseInt(event.target.id.replace($typesection,'').replace('_remove',''));\n                    let $formDefault = [];\n                    \n                    if (window.location.href.includes('action=edit')) {\n                        let url = new URL(window.location.href);\n                        var ruleid = url.searchParams.get('ruleid');\n                        if (ruleid) {\n                            $formDefault.push(\"[id]ruleid[/id][value]\"+ruleid+\"[/value]\");\n                        }\n                    }\n    \n                    let formNotif = document.querySelector('form[action*=\"notificationsagent\"].mform');\n                    let idSectionRemove = \"\";\n                    Array.from(formNotif.elements).forEach((element) => {\n                        if(element.id){\n                            var elementID = element.id;\n                            var keySection = elementID.split('_'+$typesection).pop().split('_')[0];\n                            if(element.id.includes(\"_\"+$typesection)){\n                                //¿Eres la sección eliminada?\n                                if(idSectionRemove && idSectionRemove < keySection){\n                                    //Si lo eres, reduce en 1 el id de la sección (condition, action...)\n                                    var elementID = element.id.split($typesection + keySection).join($typesection + (keySection - 1));\n                                }\n                            }\n\n                            //Si no perteneces a la sección eliminada, te guardo el valor\n                            if(!element.id.includes($typesection+($keyelementsession+1))){\n                                $formDefault.push(\"[id]\"+elementID+\"[/id][value]\"+element.value+\"[/value]\");\n                            }else{\n                                //Si perteneces a la sección eliminada, idSectionRemove de la sección y las secciones posteriores reducir a 1 el id de las secciones posteriores\n                                idSectionRemove = $keyelementsession+1;\n                            }\n                        }\n                    });\n\n                    let data = {\n                        key: $typesection,\n                        action: $actionelement,\n                        keyelementsession: $keyelementsession,\n                        formDefault: $formDefault\n                    };\n                    if (data.key === 'conditionexception') {\n                        data.key = data.key.replace(/condition/, '');\n                    }\n\n                    $.ajax({\n                        type: \"POST\",\n                        url: window.location.pathname.substring(0, '/local/notificationsagent/editrule.php'),\n                        data: data,\n                        success: function(event) {\n                            if(event.state === 'success'){\n                                window.location.reload();\n                            }\n                        },\n                        error: function(XMLHttpRequest, textStatus, errorThrown) { \n                            console.log(\"Status: \" + textStatus); \n                            console.log(errorThrown); \n                        },\n                        dataType: 'json'\n                    });\n                    \n                });\n            });\n        }\n    }\n});"],"names":["define","init","document","querySelectorAll","forEach","button","addEventListener","event","$typesection","target","id","split","replace","$actionelement","$keyelementsession","parseInt","$formDefault","window","location","href","includes","ruleid","URL","searchParams","get","push","formNotif","querySelector","idSectionRemove","Array","from","elements","element","keySection","elementID","pop","join","value","data","key","action","keyelementsession","formDefault","$","ajax","type","url","pathname","substring","success","state","reload","error","XMLHttpRequest","textStatus","errorThrown","console","log","dataType"],"mappings":";;;;;;;;AAwBCA,mEAAO,IAAI,iBAED,CAEHC,KAAM,WAEkBC,SAASC,iBAAiB,qCAChCC,SAAS,SAASC,QAC5BA,OAAOC,iBAAiB,SAAS,SAASC,WAClCC,aAAeD,MAAME,OAAOC,GAAGC,MAAM,KAAK,GAAGC,QAAQ,SAAU,IAC/DC,eAAiBN,MAAME,OAAOC,GAAGC,MAAM,KAAK,GAC5CG,mBAAqBC,SAASR,MAAME,OAAOC,GAAGE,QAAQJ,aAAa,IAAII,QAAQ,UAAU,KACzFI,aAAe,MAEfC,OAAOC,SAASC,KAAKC,SAAS,eAAgB,KAE1CC,OADM,IAAIC,IAAIL,OAAOC,SAASC,MACjBI,aAAaC,IAAI,UAC9BH,QACAL,aAAaS,KAAK,yBAAyBJ,OAAO,gBAItDK,UAAYxB,SAASyB,cAAc,4CACnCC,gBAAkB,GACtBC,MAAMC,KAAKJ,UAAUK,UAAU3B,SAAS4B,aACjCA,QAAQtB,GAAG,KAENuB,YADAC,UAAYF,QAAQtB,IACGC,MAAM,IAAIH,cAAc2B,MAAMxB,MAAM,KAAK,MACjEqB,QAAQtB,GAAGU,SAAS,IAAIZ,eAEpBoB,iBAAmBA,gBAAkBK,eAEhCC,UAAYF,QAAQtB,GAAGC,MAAMH,aAAeyB,YAAYG,KAAK5B,cAAgByB,WAAa,IAKlGD,QAAQtB,GAAGU,SAASZ,cAAcM,mBAAmB,IAIrDc,gBAAkBd,mBAAmB,EAHrCE,aAAaS,KAAK,OAAOS,UAAU,eAAeF,QAAQK,MAAM,oBAQxEC,KAAO,CACPC,IAAK/B,aACLgC,OAAQ3B,eACR4B,kBAAmB3B,mBACnB4B,YAAa1B,cAEA,uBAAbsB,KAAKC,MACLD,KAAKC,IAAMD,KAAKC,IAAI3B,QAAQ,YAAa,KAG7C+B,EAAEC,KAAK,CACHC,KAAM,OACNC,IAAK7B,OAAOC,SAAS6B,SAASC,UAAU,EAAG,0CAC3CV,KAAMA,KACNW,QAAS,SAAS1C,OACK,YAAhBA,MAAM2C,OACLjC,OAAOC,SAASiC,UAGxBC,MAAO,SAASC,eAAgBC,WAAYC,aACxCC,QAAQC,IAAI,WAAaH,YACzBE,QAAQC,IAAIF,cAEhBG,SAAU"}