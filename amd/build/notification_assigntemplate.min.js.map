{"version":3,"file":"notification_assigntemplate.min.js","sources":["../src/notification_assigntemplate.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n *\n * @module   local_notificationsagent/assigntemplate\n * @copyright 2023, ISYC\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([], function() {\n\n    return {\n\n        init: function() {\n            var module = this;\n            var idtemplate;\n            $('#assignTemplateModal').on('show.bs.modal', function (event) {\n                var button = $(event.relatedTarget);\n                idtemplate = button.data('idtemplate');\n    \n                var modal = $(this);\n                modal.find('.modal-title > span').text($('#card-'+idtemplate+' .badge').text());\n                modal.find('.badge').text($('#card-'+idtemplate+' .badge').text());\n                modal.find('.badge').attr('class', 'mr-2 '+$('#card-'+idtemplate+' .badge').attr('class'));\n                \n                modal.find('.modal-body .name').text($('#card-'+idtemplate+' .name').text());\n\n                /* Rellenar cursos asignados */\n                $.ajax({\n                    type: \"POST\",\n                    url: '/local/notificationsagent/assignrule.php',\n                    data: {\n                        idRule: idtemplate\n                    },\n                    success: function(listofCoursesAssigned) {\n                        listofCoursesAssigned.forEach((idcourse) => {\n                            var courseassigned = $('#assignTemplateModal .category-listing input#checkboxcourse-'+idcourse);\n                            if(courseassigned.length){\n                                courseassigned.prop('checked', true);\n                                var arrayCategoriesParents = module.loopatfirstparent(courseassigned.attr('data-parent'));\n                                arrayCategoriesParents.forEach((idcategory) => {\n                                    module.checkhascategoryparent(idcategory);\n                                });\n                            }\n                        });\n                    },\n                    error: function(XMLHttpRequest, textStatus, errorThrown) { \n                        console.log(\"Status: \" + textStatus); \n                        console.log(errorThrown); \n                    },\n                    dataType: 'json'\n                });\n            });\n            $('#assignTemplateModal').on('hide.bs.modal', function () {\n                $('#assignTemplateModal .custom-control-input').prop('checked', false);\n            });\n            $('#assignTemplateModal .collapse').on('show.bs.collapse', function () {\n                $(this).parents('.listitem-category').removeClass('collapsed');\n            });\n            $('#assignTemplateModal .collapse').on('hide.bs.collapse', function () {\n                $(this).parents('.listitem-category').addClass('collapsed');\n            });\n\n            /* checkbox */\n            $('#assignTemplateModal #course-category-select-all').on('click', function(){\n                var checkassign = $('#assignTemplateModal .category-listing .custom-control-input');\n                checkassign.prop('checked', $(this).prop('checked'));\n            });\n            $('#assignTemplateModal .category-listing').on('change', 'input[type=checkbox]', function () {\n                var checkssubcategoriescourses = '#category-listing-content-'+$(this).attr(\"id\").replace('checkboxcategory-', '')+' .custom-control-input';\n                $('#assignTemplateModal .category-listing '+checkssubcategoriescourses).prop('checked', $(this).prop('checked'));\n\n                if($(this).attr('data-parent') != '#category-listing-content-0'){\n                    var arrayCategoriesParents = module.loopatfirstparent($(this).attr('data-parent'));\n                    arrayCategoriesParents.forEach((idcategory) => {\n                        module.checkhascategoryparent(idcategory);\n                    });\n                }\n\n                /* Check all checks true */\n                var arrayCategoriesfirstlevel = $('#assignTemplateModal .category-listing input[type=checkbox][data-parent=\"#category-listing-content-0\"]');\n                var allelementsatchecked = true;\n                arrayCategoriesfirstlevel.each(function(){\n                    if(!$(this).prop('checked')){\n                        allelementsatchecked = false;\n                        return false;\n                    }\n                });\n                if(allelementsatchecked){\n                    $('#assignTemplateModal #course-category-select-all').prop('checked', true);\n                }else{\n                    $('#assignTemplateModal #course-category-select-all').prop('checked', '');\n                }\n            });\n\n            $('#assignTemplateModal #saveassignTemplateModal').on('click', function(){\n                var $arrayCourses = [];\n                \n                var checkassign = $('#assignTemplateModal .category-listing input[id^=\"checkboxcourse-\"]');\n                checkassign.each(function(){\n                    if($(this).prop('checked') == true){\n                        $arrayCourses.push($(this).attr('id').replace('checkboxcourse-', ''));\n                    }\n                });\n                let data = {\n                    arrayCourses: $arrayCourses,\n                    idRule : idtemplate,\n                };\n                //Se necesitará hacer AJAX para guardar en BD y al guardar sacar un alert de que se ha guardado correctamente después de cerrar el modal\n                $.ajax({\n                    type: \"POST\",\n                    url: '/local/notificationsagent/assignrule.php',\n                    data: data,\n                    success: function(addlistofcoursesassigned) {\n                        window.location.reload();  \n\n                    },\n                    error: function(XMLHttpRequest, textStatus, errorThrown) { \n                        console.log(\"Status: \" + textStatus); \n                        console.log(errorThrown); \n                    },\n                    dataType: 'json'\n                });\n                   \n            });\n        },\n        checkhascategoryparent: function(idparent) {\n            var allelementscatchecked = true;\n            $('#assignTemplateModal .category-listing #category-listing-content-'+idparent+' .custom-control-input').each(function(){\n                if(!$(this).prop('checked')){\n                    allelementscatchecked = false;\n                    return false;\n                }\n            });\n            if(allelementscatchecked){\n                $('#assignTemplateModal .category-listing #listitem-category-'+idparent+' > .category-listing-header .custom-control-input').prop('checked', true);\n            }else{\n                $('#assignTemplateModal .category-listing #listitem-category-'+idparent+' > .category-listing-header .custom-control-input').prop('checked', '');\n            }\n        },\n        loopatfirstparent: function(idparent, arrayParents = []){\n            var module = this;\n            \n            if(idparent != '#category-listing-content-0'){\n                arrayParents.push(idparent.replace('#category-listing-content-', ''));\n                var dataparent = $('#assignTemplateModal .category-listing #listitem-category-'+idparent.replace('#category-listing-content-', '')+' > .category-listing-header .custom-control-input').attr('data-parent');\n                return module.loopatfirstparent(dataparent, arrayParents);\n            }else{\n                return arrayParents;\n            }\n        }\n    };\n});\n"],"names":["define","init","idtemplate","module","this","$","on","event","button","relatedTarget","data","modal","find","text","attr","ajax","type","url","idRule","success","listofCoursesAssigned","forEach","idcourse","courseassigned","length","prop","loopatfirstparent","idcategory","checkhascategoryparent","error","XMLHttpRequest","textStatus","errorThrown","console","log","dataType","parents","removeClass","addClass","checkssubcategoriescourses","replace","arrayCategoriesfirstlevel","allelementsatchecked","each","$arrayCourses","push","arrayCourses","addlistofcoursesassigned","window","location","reload","idparent","allelementscatchecked","arrayParents","dataparent"],"mappings":"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"}