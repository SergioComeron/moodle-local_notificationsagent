/**
 *
 * @module   local_notificationsagent/assigntemplate
 * @copyright 2023, ISYC
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */ define([],function(){return{init:function(){var t=this;$("#assignTemplateModal").on("show.bs.modal",function(e){var a=$(e.relatedTarget).data("idtemplate"),o=$(this);o.find(".modal-title > span").text($("#card-"+a+" .badge").text()),o.find(".badge").text($("#card-"+a+" .badge").text()),o.find(".badge").attr("class","mr-2 "+$("#card-"+a+" .badge").attr("class")),o.find(".modal-body .name").text($("#card-"+a+" .name").text()),$.ajax({type:"POST",url:"/local/notificationsagent/lib.php",data:{idRule:a},success:function(e){e.forEach(e=>{var a=$("#assignTemplateModal .category-listing input#checkboxcourse-"+e);a.length&&(a.prop("checked",!0),t.loopatfirstparent(a.attr("data-parent")).forEach(e=>{t.checkhascategoryparent(e)}))})},error:function(t,e,a){console.log("Status: "+e),console.log(a)},dataType:"json"})}),$("#assignTemplateModal").on("hide.bs.modal",function(){$("#assignTemplateModal .custom-control-input").prop("checked",!1)}),$("#assignTemplateModal .collapse").on("show.bs.collapse",function(){$(this).parents(".listitem-category").removeClass("collapsed")}),$("#assignTemplateModal .collapse").on("hide.bs.collapse",function(){$(this).parents(".listitem-category").addClass("collapsed")}),$("#assignTemplateModal #course-category-select-all").on("click",function(){$("#assignTemplateModal .category-listing .custom-control-input").prop("checked",$(this).prop("checked"))}),$("#assignTemplateModal .category-listing").on("change","input[type=checkbox]",function(){var e="#category-listing-content-"+$(this).attr("id").replace("checkboxcategory-","")+" .custom-control-input";$("#assignTemplateModal .category-listing "+e).prop("checked",$(this).prop("checked")),"#category-listing-content-0"!=$(this).attr("data-parent")&&t.loopatfirstparent($(this).attr("data-parent")).forEach(e=>{t.checkhascategoryparent(e)});var a=$('#assignTemplateModal .category-listing input[type=checkbox][data-parent="#category-listing-content-0"]'),o=!0;a.each(function(){if(!$(this).prop("checked"))return o=!1,!1}),o?$("#assignTemplateModal #course-category-select-all").prop("checked",!0):$("#assignTemplateModal #course-category-select-all").prop("checked","")}),$("#assignTemplateModal #saveassignTemplateModal").on("click",function(){var t=[];$('#assignTemplateModal .category-listing input[id^="checkboxcourse-"]').each(function(){!0==$(this).prop("checked")&&t.push($(this).attr("id").replace("checkboxcourse-",""))}),console.log(t)})},checkhascategoryparent:function(t){var e=!0;$("#assignTemplateModal .category-listing #category-listing-content-"+t+" .custom-control-input").each(function(){if(!$(this).prop("checked"))return e=!1,!1}),e?$("#assignTemplateModal .category-listing #listitem-category-"+t+" > .category-listing-header .custom-control-input").prop("checked",!0):$("#assignTemplateModal .category-listing #listitem-category-"+t+" > .category-listing-header .custom-control-input").prop("checked","")},loopatfirstparent:function(t,e=[]){if("#category-listing-content-0"==t)return e;e.push(t.replace("#category-listing-content-",""));var a=$("#assignTemplateModal .category-listing #listitem-category-"+t.replace("#category-listing-content-","")+" > .category-listing-header .custom-control-input").attr("data-parent");return this.loopatfirstparent(a,e)}}});